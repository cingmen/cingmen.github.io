name: Automated Media Optimization

on:
  push:
    branches: [ main ]
    paths:
      - '_posts/**.jpg'
      - '_posts/**.jpeg'
      - '_posts/**.png'
      - '_posts/**.webp'

jobs:
  build:
    name: Image Compression Protocol
    runs-on: ubuntu-latest
    steps:
      - name: Retrieve Repository Assets
        uses: actions/checkout@v4

      - name: Execute Image Compression
        uses: calibreapp/image-actions@main
        with:
          githubToken: ${{ secrets.GITHUB_TOKEN }}
          # Specifically targeting the research log directory
          ignorePaths: 'node_modules/**,assets/favicons/**'
          compressOnly: true
          jpegQuality: '80'
          pngQuality: '80'
          webpQuality: '80'

      - name: Commit Optimized Media
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "perf: automated media compression for improved payload"